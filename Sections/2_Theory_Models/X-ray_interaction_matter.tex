\newpage
\section{X-ray interaction with matter} \label{sec:XRIntMatter}

Understanding the different mechanisms at play when photons interact with matter is of crucial importance to be able to decide how to use x-rays as a probe in material science.
Each phenomenon is at the source of different techniques, scattering brings surface x-ray diffraction (SXRD) and Bragg coherent diffraction imaging (BCDI), two techniques used in the frame of this thesis that give complementary information about the sample structure bulk and surface.

X-ray absorption together with the photoelectric effect explained by Einstein in 1905 are at the source of a third technique used, x-ray photoelectron spectroscopy, which yields information specific to the nature of the adsorbates on the sample's surface.

\begin{table}[!htb]
    \centering
    \small
    \begin{tabular}{l|l|l|l}
        Technique & Sample & Sensitivity & Information \\
        \toprule
        Bragg Coherent & Pt nanoparticles & Bragg electronic & Shape, 3D strain  \\
        Diffraction Imaging & (111), (110), (100), ... & density and phase & and displacement \\
        (BCDI) &  &  & \\
        \midrule
        Surface x-ray & Pt single crystals & Surface & Roughness, relaxation \\
        Diffraction (SXRD) & (111), (100), (311) & structure & and crystallographic phases \\
        \midrule
        x-ray Photoelectron & Pt single crystals & Surface & Species presence, \\
        Spectroscopy (XPS) & (111), (100) & species & quantity, oxidation state \\
        \bottomrule
    \end{tabular}
    \caption{Near-ambient pressure (NAP) x-ray techniques carried out at the SixS (SOLEIL) \\ or B-07 (Diamond) beamlines}
    \label{tab:techniques}
\end{table}

\begin{figure}[!htb]
    \centering
    \includegraphics[height=0.25\textwidth]{/home/david/Documents/PhD/Presentations/Slides/PhdSlides/Figures/gwaihir/dp_pr.png}
    \includegraphics[height=0.25\textwidth]{/home/david/Documents/PhD/Presentations/Slides/PhdSlides/Figures/sxrd_data/Pt100/maps/Map_hkl_surf_or_2227-2283_not_patched.png}
    \includegraphics[height=0.25\textwidth]{/home/david/Documents/PhD/Presentations/Slides/PhdSlides/Figures/xps_data/transition_xps.png}
    \caption{Slice of 3D diffraction pattern collected at the SixS beamline at the SOLEIL synchrotron (left). Reciprocal space map in HK plane collected at the SixS beamline at the SOLEIL synchrotron (middle). Ambient pressure XPS spectra collected during a transition between two atmospheres (Ar and O$_2$), collected at the B07 beamline at the Diamond synchrotron (right).}
\end{figure}


In this chapter we will discuss the origin of each technique from fundamentals that not only tailor their experimental design but also their operability and sensitivity.

\subsection{Scattering from electrons and atoms}

The duality between wave and particles was first mentionned by Max Planck and Albert Einstein in the early 20$^{th}$ century and generalized to all matter by Louis-Victor de Broglie in 1924 with the famous formula:

\begin{equation}
	\lambda = \frac{h}{p}
\end{equation}

Electromagnetic waves, \textit{i.e.} light or photons can be characterized by their energy $E$ in \si{\electronvolt} and wavelength $\lambda$ in \si{\meter}. $p$ corresponds to the momentum transfer.
The conversion between is realized thanks to Planck's constant $h = 6.626 \times 10^{-34}$ \si{\joule.\second} and the speed of light in vacuum $c = 2.9979 \times 10^{8}$ \si{\meter.\per \second} (eq. \ref{eq:EnergyLambda}).

\begin{equation}
    \label{eq:EnergyLambda}
	E = \frac{hc}{\lambda}
\end{equation}

The properties of the photon and its use in our society depends on its energy and wavelength.
If visible light is situated between $500 \, \si{\electronvolt}$ and $900 \, \si{\electronvolt}$, micro-waves used in our everyday life are situated between $10^{-6} \si{\electronvolt}$ and $10^{-4}\si{\electronvolt}$.
On the other side of the electromagnetic spectrum, we have higher energy photons such as x-rays ($\in [10^{2}, 10^{6}] \si{\electronvolt}$) and $\gamma$-rays (above $10^{6}$ $\si{\electronvolt}$).

x-rays have a wavelength of a few \si{\angstrom} ($10^{-10} \:\si{\meter}$) making them the perfect probe to study the structures of materials at the atomic scale thanks to different interactions with matter.
\textcolor{Important}{Explain why this particular wl is the best}

\subsubsection{Cross-sections}

When an electromagnectic wave interacts with matter it will be attenuated by absorption, reflection or scattering.
Each process can be quantified depending on the atoms (and thus on the electronic cloud) the beam interacts with and the energy on the incident photon, this is illustrated in figure \ref{fig:cross_sections}.
The cross-section for a particuliar process $p$ is defined as follows \parencite{Willmott}:

\begin{equation}
	\sigma_p = (\Lambda_p N_i)^{-1}
\end{equation}

$\Lambda_p$ is the attenuation length in \si{\meter}, \textit{i.e.} the length after which the beam's intensity is reduced to $1/e$, $N_i$ is the atomic number-density in atoms/unit volume.

\begin{figure}[!htb]
    \centering
    \includegraphics[width=\textwidth]{Figures/introduction/cross_sections.pdf}
    \caption{Cross-sections for platinum (Z=78) for various processes that occur when photons interact with matter. The data was taken from the NIST (National Institute of Standards and Technology) \parencite{NIST_cross_sections} website. The energy range of the SixS beamline at SOLEIL is highlighted in blue.}
    \label{fig:cross_sections}
\end{figure}

Compton scattering, also named inelastic scattering, is a process during which some of the incident electromagnetic wave energy is transfered to the atoms' electrons.
This results in a lower energy for the scattered photon (and therefore a higher wavelength) compared to the incident photon.
%This effect has a low cross-section compared to the two other processes and is therefore not taken account during the experiments.

In the frame of this thesis, the (elastic) Thomson scattering cross-sections is the most important, at the origin of x-ray diffraction.
This process is dominant for energies below $200 \si{k\electronvolt}$, together with photoelectric absorption.% for which the K, L and M edges are shown.

\subsubsection{Scattering from an electron}

We begin our discussion of x-ray scattering by considering scattering from a single free electron using classical electromagnetic theory.
During elastic scattering, the oscillating electric field of the incident x-ray wave exerts an electromagnetic force on the electron, causing it to accelerate and oscillate in the same direction as the incident electronic field.

\begin{figure}[!htb]
    \centering
    \includegraphics[trim=0 75 0 25, clip, width=\textwidth]{Figures/introduction/torus.pdf}
    \caption{
        Effect of relation between synchrotron x-ray polarization $\hat{\epsilon}$ and scattered x-ray polarization $\hat{\epsilon}'$ on the scattered field.
        Working in the vertical plane ($\vec{x}, \vec{z}$) is preferable to maximize the intensity of the scattered field, this has pratical repercussions in surface x-ray diffraction for which it is preferable to work in a vertical geometry to scan large 2D areas of the reciprocal space (a).
        The scattered field intensity is attenuated by a $\cos{(\theta)}$ factor, where $\theta$ is the angle between the plane perpendicular to the electric field and the direction of observation $\vec{R}$ (b)
    }
    \label{fig:polarization_effect}
\end{figure}

During an elastic scattering event, the oscillating electron emits a spherical electromagnetic wave with the same wavelength as the incident beam (Thomson scattering).
The scattered field $\vec{E}_{scatt}$ is then proportional to the incident electromagnetic field $\vec{E}_{in}$ as follows \parencite{NielsenMcMorrow}:

\begin{equation}
    \label{eq:scatt_field}
    \frac{\vec{E}_{scatt}(R, \, t)} {\vec{E}_{in}} = -r_0 \frac{e^{\vec{k}.\vec{R}}} {|\vec{R}|}| \hat{\epsilon}.\hat{\epsilon}'|
\end{equation}
$|\vec{R}|$ is the distance at which the scattering is detected at the time $t$, $\hat{\epsilon}$ is the synchrotron x-ray polarization vector, $\hat{\epsilon}'$ the scattered x-ray polarization vector, and $r_0$ is the Thomson scattering length or the classical radius of the electron defined as:

\begin{equation}
    \label{eq:scatt_thomson_scat_length}
    r_0 = \frac{e^2} {4\pi\epsilon_0 m_e c^2}
\end{equation}
with $m_e$ the mass of the electron and $\epsilon_0$ the permittivity of free space.

The minus sign illustrates a phase shift of $\pi$ between the incident and scattered wave, $\hat{\epsilon}$ and $\hat{\epsilon}'$ are respectively the polarization vectors of the incident and scattered electromagnectic fields.

The differential cross-section for Thomson scattering measures the efficiency of the scattering in the volume occupied by a solid angle $d\Omega$ in the direction $\vec{R}$ \parencite{NielsenMcMorrow}. It is defined as follows:
\begin{equation}
    \label{eq:dif_cross_sec_thomson1}
    \frac{d\sigma_{ts}} {d \Omega} = \frac{ |\vec{E}_{scatt}(R, t)|^2 R^2} {|\vec{E}_{in}|^2}
\end{equation}

By substituting eq. \ref{eq:scatt_field} into eq. \ref{eq:dif_cross_sec_thomson1}, it becomes clear that the scattering is proportional to the Thomson scattering length and that the intenisty is attenuated depending on the dot product between the two polarizations.
The polarization factor $P$ for scattered beams is defined as $P =  | \hat{\epsilon}.\hat{\epsilon}'|^2$ and we can write the differential cross-section as:

\begin{equation}
    \frac{d\sigma_{ts}} {d \Omega} = r_0^2 | \hat{\epsilon}.\hat{\epsilon}'|^2 = r_0^2 P
\end{equation}

The effect of the polarization of the incident beam is illustrated in figure \ref{fig:polarization_effect}.
At synchrotron sources where the incident beam is horizontally polarized, working in the vertical plane becomes more effective since the polarization factor is always equal to one.

The total cross-section for the scattering event by a single free electron can be computed by integrating the differential cross-section over all the possible scattering angles, \textit{i.e.} by averaging all possible polarization directions \parencite{Willmott}.
This yields $\sigma_{ts} = 8 \pi r_0^2 /3 = 0.665 \:\si{\barn}$, the total Thomson scattering cross-section is constant, independent of the incoming photon energy. This results holds for x-rays for which the scatterer \textit{i.e.} the electron can be considered as free \parencite{Willmott}.

\subsubsection{Scattering from a single atom}\label{sec:scattering}

As we have seen the main scatterer for Thomson scattering is the electron.
An atom can be described as a small volume $d^3\vec{r}$ in which the electrons are localized.
The electromagnetic field scattered from an atom is therefore proportional to the atomic electronic density $\rho_{atom}(\vec{r})$.
For a single atom of atomic number $Z$ we have :

\begin{equation}
    \int \rho_{atom} (\vec{r}) d^3\vec{r} = Z
\end{equation}

To describe the phase of the scattered field, which depends on the phase of each incident wave at each point in the scattering volume (fig. \ref{fig:q}), we introduce the scattering vector, $\vec{q}$ (eq. \ref{eq:Q}), to derive the amplitude of a scattering event in the direction defined by the scattering angle $2\theta$.

\begin{equation}
    \label{eq:Q}
    \vec{q}=\vec{k_s}-\vec{k_i}.
\end{equation}

\begin{figure}[!htb]
    \centering
    \includegraphics[scale=0.6]{Figures/introduction/q.pdf}
    \caption{
    Geometry of the scattering vector $\vec{q}$ in reciprocal space, $2\theta$ is the scattering angle.
    The magnitude of the scattering vector can be derived with the angle $\theta$ that draws a line cutting $\vec{q}$ at $|\vec{q}|/2$.
    }
    \label{fig:q}
\end{figure}

Therefore, the phase difference between a wave scattered at a position $O$ and a wave scattered at a distance $\vec{r}$ from $O$ is equal to $(\vec{k_i} - \vec{k_s}).\vec{r} = \vec{q}.\vec{r}$ (fig. \ref{fig:q}).

From fig. \ref{fig:q} and the relation between wavevector and wavelength ($k = 2 \pi/\lambda$), the scattering vector can be written as a function of the wavelength of the incident beam $\lambda$, and of the direction of detection defined by the scattering angle $2\theta$ (eq. \ref{eq:QSinTheta}) between the wavevector of the incident photon $\vec{k_i}$ and the wavevector of the scattered photon $\vec{k_s}$.
We assume here that the scattering event is elastic ($|\vec{k_i}|=|\vec{k_s}|$) and that the waves are plane waves parallel to each other when in the small scattering volume $d^3\vec{r}$.

\begin{equation}
    \label{eq:QSinTheta}
    |\vec{q}| = \frac{4\pi}{\lambda} \sin{\theta}
\end{equation}

Each electron in the small volume $d^3\vec{r}$ will have a contribution proportional to the Thomson scattering length $r_0$ to the scattered field with a phase $e^{i\vec{q}.\vec{r}}$.
By integrating over the volume occupied by the atom we obtain the total contribution of an atom to the scattered field in the direction $2\theta$:

\begin{equation}
    \label{eq:AtomicFormFactor}
    -r_0 \int \rho_{atom} (\vec{r}) e^{i\vec{q}.\vec{r}} d\vec{r} = -r_0 f^0(\vec{q}) = -r_0 FT [\rho_{atom} (\vec{r})]
\end{equation}

The scattering amplitude as a function of $\vec{q}$ is described by the atomic from factor $f^0(\vec{q})$, which is defined as the Fourier transform of the atomic electronic density $\rho_{atom}(\vec{r})$.
The values for the atomic from factor can be approximated by a sum of Gaussians using tabulated coefficients (eq. \ref{eq:AtomicFormFactorTab}) available online \parencite{InterTablesOfCryst}.
It decreases with $\vec{q}$ (or $\sin(\theta) / \lambda)$ as illustrated in figure \ref{fig:atomic_form_factor}.

\begin{equation}
    \label{eq:AtomicFormFactorTab}
    f^0(\vec{q}) = \sum_{i=1}^4 a_i \exp (-b_i (\frac{q} {4\pi})^2) + c
\end{equation}

The scattering intensity is equal to the square of the scattering amplitude.
For example, the scattering intensity of palladium atoms at $|\vec{q}| \approx 2.75 \AA^{-1}$ is only $\approx 31\%$ of that of platinum atoms. In the case of oxygen, the intensity falls down to $\approx 6.7\%$.
This difference in scattering intensity between elements becomes crucial when working with small objects that have a small scattering volume such as nanoparticles.

\begin{figure}[!htb]
    \centering
    \includegraphics[width=\textwidth]{Figures/introduction/atomic_form_factor.pdf}
    \caption{
    Atomic form factor calculated for Pt (Z=78) using tabulated values \parencite{InterTablesOfCryst} for equation \ref{eq:AtomicFormFactor}. The scattering intensity decreases with the scattering angle $\theta$ but increases with the incident wavelength $\lambda$. $i$ and $c$ respectively designate the Gaussian contribution and constant in eq. \ref{eq:AtomicFormFactorTab}.
    }
    \label{fig:atomic_form_factor}
\end{figure}

\subsection{Refraction, reflection and absorption effects}\label{sec:RefractionReflectionAbsorption}

For now we have considered the electron as free.
However, electrons in atoms or molecules exist in discrete bound states (characterised by a binding energy $E_b$), and their response to the incoming electromagnetic field becomes dependent on the incoming energy.
In a classical point of view, we can reconsider the bound electron as a damped harmonic oscillator with associated resonant frequencies $\omega_b$ corresponding to the electron's binding energy.
First, when approaching the binding energy, the amplitude of the electron's oscillation are reduced and so is the atomic form factor by a real energy-dependant factor $f'(\hbar\omega)$.
Secondly, when approaching the binding energy, the oscillation of the scattering electron experiences a phase lag.
This is taken into account by introducing an imaginary energy-dependent factor $f''(\hbar\omega)$.
The atomic form factor $f^0(\vec{q})$ must therefore be corrected by these two correction factors, we define the total atomic form factor $f(q, \hbar\omega)$ as \parencite{NielsenMcMorrow}:

\begin{equation}
    f(\vec{q}, \hbar\omega) = f^0(\vec{q}) + f'(\hbar\omega) + if''(\hbar\omega) = f_1(\vec{q}, \hbar\omega) + i f_2(\hbar\omega)
\end{equation}

The values of the correction factors $f'$ and $f''$, also known as the dispersion corrections to $f^0$, depend on the electronic structure of the atom and are maximum when approaching the binding energies of the electrons in the atom.
To understand the impact of the correction factors on the electromagnetic wave inside a material, we introduce the complex refraction index $n$, which for x-rays can be written as:

\begin{gather}
    n = 1-\delta+i\beta = 1 - \frac{r_0 \lambda^2}{2\pi} \sum_i N_i f_i(\vec{q}=0)\\
    \label{eq:delta}
    \delta = \frac{r_0 \lambda^2}{2\pi} \sum_i N_i f_1(\vec{q}=0)\\
    \beta = \frac{r_0 \lambda^2}{2\pi} \sum_i N_i f_2
\end{gather}
with $f_i(\vec{q}=0)$ the total atomic form factor of the atom $i$ in the forward direction ($\vec{q}=0$), and $N_i$ the number of atoms corresponding to the element $i$ per unit volume.
$\delta$ is the refractive index and $\beta$ the absorption index.

During simple experiments, when x-rays impinge on a plane surface between air ($n$=1) and another medium of refractive index $n$, x-rays are refracted, the wavelength changes to $\lambda/n$ and the direction of propagation becomes closer to the surface between both mediums.
Below a certain incident angle known as the \textit{critical angle} $\alpha_c$ between the direction of the incident x-rays and the plane interface, the x-rays will be totally reflected.
This effect is used in focussing mirrors for optics but also in techniques used to probe the surface of materials to obtain information about the surface density since the critical angle is approximately equal to $\sqrt{2\rho}$ \parencite{Willmott}.
Moreover, during surface x-ray diffraction, the incoming angle perpendicular to the surface is kept to very low values approaching the critical angle to limit the volume probed by the x-rays to increase the contrast between the amplitude of the x-rays scattered from the bulk in regard to the x-rays scattered from the latest surface layers.
The penetration depth of the x-rays in the material is detailed is sec. \ref{sec:SXRD}.

Far from the binding energies of the electron in the system, the correction factor $f'$ in the expression of $\delta$ can be ignored and the sum in eq. \ref{eq:delta} is then equal to the electronic density of the system.

Finally, to highlight the impact of the complex part of the absorption index $\beta$, we express the electric field of a plane electromagnetic wave propagating in the $\vec{z}$ direction inside a material of refractive index $n$ as follows:

\begin{equation}
    E(\vec{z}, t) = E_0 e^{i(n\vec{k}.\vec{z} - wt)} = E_0 e^{-\beta \vec{k}.\vec{z}} e^{i(\delta\vec{k}.\vec{z} - wt)}
\end{equation}

The imaginary part of the form factor translates into an exponential decay of the intensity of the incoming wave as a function of the absorption index $\beta$, the intensity of the electromagnetic field decreases; \textit{i.e.} the wave is absorbed by the material.
The absorption of the photons by the material is at the origin of many different phenomena such as the promotion of electrons to either higher energetic bound states or directly to vacuum.
The kinetic energy of the electrons released from the material in the latter scenario is equal to the incident photon energy $\hbar\omega$ minus the energy required to release the electron from its bound state $E_b$, minus the energy required for the electron to escape from the electronic cloud $W$ (also known as the work function).

\begin{equation}
    E_{kin} = \hbar\omega - W - E_b
\end{equation}

Measuring the kinetic energy of the photoelectron that escaped the material yields direct information about the different binding energies present in the material, \textit{i.e.} about its electronic structure.
The study of these kinetic energy is known as x-ray photoelectron spectroscopy (XPS),
a technique used in this thesis to study the electronic structure of the latest atomic layers of a surface, electrons released from atoms in deeper layers being ultimately absorbed(more like cancelled due to the interraction with the e cloud of) by the surrounding atoms.
The cross-section for XPS is directly proportional to the absorption cross-section $\sigma_a$ (eq. \ref{eq:AbsorptionCrossSection}, fig. \ref{fig:cross_sections}) which can be derived from the imaginary atomic form factor:

\begin{equation}
    \label{eq:AbsorptionCrossSection}
    \sigma_a(\hbar\omega) = 2 r_0 \lambda f_2(\hbar\omega)
\end{equation}

\section{Scattering from crystals}

A crystal is a solid material composed of a regular, repeating arrangement of atoms, ions, or molecules (\textit{i.e.} a pattern), exhibiting a highly ordered structure with long-range periodicity in three dimensions.

A Bravais lattice refers to an infinite array of points (nodes) that represents the basic repeating unit of a crystal lattice, defining the translational symmetry of the crystal structure.
It is characterized by a set of three basis vectors and their linear combinations, which generate the entire lattice when translated in space.
The \textit{primitive} unit cell is the smallest cell with which you can describe the crystal.

The structure of the Bravais lattice (cubic, hexagonal, ...) combined with the position of the patterns in the lattice and the symmetry relations between them defines the crystal \textit{space group}.
In total there exist 230 space group in crystallography.
In the simplest case the pattern consists of a single atom, for example pure platinum (Z=78) cristallizes at room temperature in a cubic Bravais lattice (fig. \ref{fig:fcc}).

We can define the scattering factor $F_{crystal}$ of the crystal, that describes the amplitude of the scattered waves, by the sum of the atomic scattering factor $f_j(\vec{q})$ of each atom present in the crystal, while the phases between the scattered waves depend on the positions of the atoms $\vec{R}_j$ in the direction that is perpendicular to the scattering vector $\vec{q}$ (eq. \ref{eq:FCrystal1}).
In other words, each atom can be described as a small volume $d^3\vec{r}$ in the electronic density $\rho(\vec{r})$, and the scattered field by the superposition of the contribution from the electronic cloud surrounding the atoms.
If the atomic scattering factor is equal to the Fourier transform of the electronic density of a single atom, the structure factor of a crystal can be written as the Fourier transform of the crystal electronic density.
%Thus, the total scattering amplitude at $2\theta$ will be equal to the vector sum of the scattering amplitudes in this direction from all volume elements $d^3\vec{r}$ in $\rho(\vec{r})$ taking into account the phases between them.

\begin{equation}
    \label{eq:FCrystal1}
    F_{crystal}(\vec{q}) = \sum_j^{N_{atoms}} f_j(\vec{q}) e^{i\vec{q}.\vec{R}_j} = FT[\rho(\vec{r})]
\end{equation}

$f_j(\vec{q})$ is the atomic scattering factor of the $j^{th}$ atom at position $\vec{R}_j$ in a crystal made of $N_{atoms}$ atoms.
The Thomson scattering length is left apart for simplicity.

\begin{figure}[!htb]
    \centering
    \includegraphics[width=\textwidth]{/home/david/Documents/PhDScripts/Drawing/blender/FCC.png}
    \caption{Face centered cubic (FCC) lattice of Pt (space group 225). Atoms are represented as solid balls and situated on the corners and at the middle of the faces. The lattice parameter at room temperature is $a = 3.9254 \:\AA$. Close packed direction is achieved along the diagonal of the lateral faces, the distance between the atoms then becomes is $2.71 \:\si{\angstrom}.$}
    \label{fig:fcc}
\end{figure}

The position of any atom in the crystal $\vec{R}_j$ is equal to the sum of the position of the unit cell containing the atom $\vec{R}_{uc}$, plus its position within the unit cell $\vec{r}_j$.
For a crystals made of $N_{uc}$ unit cells each composed of $N_{atoms,uc}$ we have:

\begin{equation}
    F_{crystal}(\vec{q}) = \sum_j^{N_{atoms,uc}} f_j(\vec{q}) e^{i\vec{q}.\vec{r}_j} \sum_k^{N_{uc}} e^{i\vec{q}.\vec{R_k}}
    \label{eq:Fcrystal}
\end{equation}

% As seen in Equation (\ref{eq:scatt_thomson_scat_length}), the Thomson scattering length is inversely proportional to the mass of the particle, while the scattering cross-section is proportional to the square of the Thomson scattering length.
% Hence the nucleus contributes less than one part in a million to the scattering amplitude and can be completely ignored.
% The charge distribution is therefore equal to the electronic density.

% When detecting the scattered field at a point $\vec{R}$, we assume that $\|vec{R}|$ is far greater than the electronic density, this is called the dipole approximation. NOT GOOD Each atom can be considered as a ball of certain radius (see \ref{fcc_lattice}).

% Furthermore, we assume that the source and detector are sufficiently far from the charge distribution so that the incident and scattered x-rays may be represented as plane waves, parallel to each other and perpendicular to the direction of propagation. % also more easily described
%This is the so-called far-field limit or the fraunhofer region.

% Finally, we assume that the charge distribution is small and that the scattering is weak so that the sample can be treated as a simple "perturbation" to the incident beam resulting in a linear problem \parencite{NielsenMcMorrow} and that the Born approximation is valid.

% Working under these assumption is known as kinematic diffraction for which we can easily derive the intensity of the scattered photons.
% We therefore ignore multiple-scattering of photons inside the sample and xxx.
% This is correct when working with low incident angles and penetration depths as for example in surface x-ray diffraction (see Section x).

% only valid in far-field, faunhofer region
% DWBA
% dipole approximation

The Bravais lattice is defined by three basis vectors $\vec{a},\ \vec{b},\ \vec{c}$ and three angles $\alpha$ [$\angle (\vec{b}, \vec{c})$] , $\beta$ [$\angle (\vec{a}, \vec{c})$] and $\gamma$ [$\angle (\vec{a}, \vec{b})$].
Any vector $\vec{R_k}$ describing the position of a node in the real space can be created by a linear combination of these three vectors:

\begin{equation}
    \label{eq:R_k}
    \vec{R_k}=n_1\vec{a} + n_2\vec{b} + n_3\vec{c}, \quad \ (n_1,n_2,n_3) \in \mathbb{Z}^3
\end{equation}

To understand the contribution of the second sum in eq. \ref{eq:Fcrystal} to the scattering amplitude, it is convenient to introduce the \textit{reciprocal space} which is the Fourier transform of the real space.
It is defined by three basis vectors $\vec{a*},\ \vec{b*},\ \vec{c*}$.
Similarly, the nodes of the reciprocal space can be accessed from its origin by a linear combination $\vec{G}$ of these three vectors.

\begin{equation}
    \vec{a^*}=\frac{2\pi}{V}(\vec{b}\times \vec{c}), \qquad
    \vec{b^*}=\frac{2\pi}{V}(\vec{c}\times \vec{a}), \qquad
    \vec{c^*}=\frac{2\pi}{V}(\vec{a}\times \vec{b}), \qquad
    \vec{a}_i . \vec{a}_j^* = \delta_{i,j}
\end{equation}

\begin{equation}
    \label{eq:G}
    \vec{G}=h\vec{a}^* + k\vec{b}^* + l\vec{c}^*, \quad \ (h,k,l) \in \mathbb{Z}^3
\end{equation}

By combining eq. \ref{eq:R_k} and eq. \ref{eq:G} we find that the solution to the second sum in eq. \ref{eq:Fcrystal}, \textit{i.e.} to the equation $\vec{q}.\vec{R_k} = n \times 2\pi$ $(\ n \in \mathbb{Z})$ is to write $\vec{q}$ as a linear combination of the reciprocal space vectors, \textit{i.e.} as $\vec{G}$.

\begin{equation}
    \label{eq:LaueCond}
    \vec{G} . \vec{R_k} = hn_1 + kn_2 + ln_3 = n \quad  with \ n \in \mathbb{Z}
\end{equation}

This is also known as the Laue condition, that ensures that only certain scattering vectors, corresponding to the reciprocal lattice points, fulfill the condition for constructive interference between the scattered waves.
These specific scattering vectors determine the scattering angles of the peaks observed in a diffraction pattern, also known as Bragg peaks.

\begin{equation}
    \vec{q} = \vec{G}  = h\vec{a}^* + k\vec{b}^* + l\vec{c}^*
\end{equation}

\subsection{Bragg's Law}

The intensity scattered from a crystal as a function of the scattering vector $\vec{q}$ provides information about the arrangement and spacing of crystalline planes perpendicular to $\vec{q}$.
The Miller indices are a set of integers used to represent the planes' orientation and spacing.
A plane denoted by the ($h, k, l$) indices intercepts the axes $\vec{a}$, $\vec{b}$, $\vec{c}$ on the points $|\vec{a}|/h, |\vec{b}|/k, |\vec{c}|/l$.
The direction perpendicular to the $(hkl)$ plane is written as $[hkl]$, the distance between each plane is $d_{hkl}$.

\begin{figure}[!htb]
    \centering
    \includegraphics[scale=0.6]{Figures/introduction/BraggLaw.pdf}
    \caption{The difference in the path length between plane waves scattered at an angle $\theta$ must be an integer multiple of wavelengths for constructive interference to occur. NOT FINISHED}
    \label{fig:BraggLaw}
\end{figure}

A Bragg peak results from the constructive interference between scattered waves at discrete values of the incident angle $2\theta$ on a specific set of crystalline planes.
From fig. \ref{fig:BraggLaw} we can retrieve the condition to have constructive interference, also known as Bragg law and given by eq. \eqref{eq:Bragglaw}.

\begin{equation}
    \label{eq:Bragglaw}
    n\lambda = 2d_{hkl} \sin{\theta}, \quad \ n \in \mathbb{Z}
\end{equation}

% \begin{gather}
%     \frac{(2\pi)^2}{d_{hkl}^2} = h^2 \, (\Vec{a^*}.\Vec{a^*}) + k^2 \,
%     \label{eq:dsquare}(\Vec{b^*}.\Vec{b^*}) + l^2 \, (\Vec{c^*}.\Vec{c^*}) + 2hk \, (\Vec{a^*}.\Vec{b^*}) + 2hl \, (\Vec{a^*}.\Vec{c^*}) + 2kl \, (\Vec{b^*}.\Vec{c^*})\\
%      \frac{(2\pi)^2}{d_{hkl}^2} = h^2 \, {a^*}^2 + k^2 \, {b^*}^2 + l^2 \, {c^*}^2 + 2hk \, {a^*}.{b^*}\cos{\gamma^*} + 2hl \, {a^*}.{c^*}\cos{\beta^*} + 2kl \, {b^*}.{c^*}\cos{\alpha^*}\\
%      \frac{(2\pi)^2}{d_{hkl}^2} = Ah^2 + Bk^2 + Cl^2 + Dhk + Ehl + Fkl
%      \label{eq:RecSpaceMetricTensor}
% \end{gather}{}

In the case of a cubic Bravais lattice, the distance between Miller planes can be written as:
\begin{equation}
    \label{eq:Interplanarspacing}
    d_{hkl}=\frac{2\pi}{|\vec{a^*}|\sqrt{h^2 + k^2 + l^2}}=\frac{|\vec{a}|}{\sqrt{h^2 + k^2 + l^2}}
\end{equation}

From eqs. \ref{eq:QSinTheta} and \ref{eq:Bragglaw}, we fall back on the Laue condition which is a generalization of Bragg law. The diffraction order ($n$) in the Bragg's law equation can be omitted since it is implicitly determined by the Miller indices (hkl) representing the crystalline planes involved in the diffraction.

\begin{gather}
    \label{eq:QandD}
    |\vec{Q}| = \frac{4\pi \sin(\theta)}{\lambda},\\
    \sin(\theta) / \lambda = \frac{1}{2d_{hkl}},\\
    |\vec{Q}| = \frac{2\pi}{d_{hkl}}
\end{gather}{}

When fulfilling the Laue (or Bragg) condition, the direction of the scattering vector is perpendicular to the crystalline planes represented by the ($h, k, l$) Miller indices, and its magnitude is inversely proportional to the distance between consecutive crystalline planes.

\subsection{Structure factor} \label{sec:StructureFactor}

On one hand, in real space, the crystal electronic density can be formed by repeating the unit cell at each lattice point, \textit{i.e.} it can be represented as a convolution of the lattice and unit cell functions.
This representation captures the periodicity and arrangement of the crystal.

On the other hand, in reciprocal space (Fourier space), the crystal scattering factor $F_{crystal}$ is the Fourier transform of the electronic density.
According to the convolution theorem, the Fourier transform of a convolution is equal to the product of the Fourier transforms of the individual functions.
The scattering factor can therefore be expressed as the product of the Fourier transforms of the lattice and unit cell functions.
These Fourier transforms are known as the lattice factor $F_{lat}$ and the unit cell structure factor $F_{uc}$.

\begin{equation}
    F_{crystal} = FT[\rho(\vec{r})] = F_{uc} \times F_{lat}
    \label{eq:FcrystalFlatFuc}
\end{equation}

The lattice factor $F_{lat}$ represents the periodic arrangement of the crystal lattice in Fourier space, corresponding to the reciprocal lattice.
It determines the positions and intensities of the diffraction peaks in the scattering pattern.
The unit cell structure factor $F_{uc}$ describes the distribution of electron density within the unit cell of the crystal and modulates the scattered beam amplitude depending on what atoms are in the unit cell (amplitude) and their positions (phase).
By identifying the different parts of eq. \ref{eq:Fcrystal} and eq. \ref{eq:FcrystalFlatFuc} we can first isolate the unit cell structure factor:

\begin{equation}
    \label{eq:StrucFactor}
    F_{uc} = \sum_j^{N_{atoms}} f_j(\vec{q}) e^{i\vec{q}.\vec{r}_j}
\end{equation}

Each diffraction peak in the scattering pattern corresponds to a specific Fourier component, representing a sinusoidal wave of electron density with a particular frequency and direction determined by its scattering vector $\vec{q}$, \textit{i.e.} by its position in Fourier space.
By knowing the phase relationships between these Fourier components, which can be obtained from the measured diffraction pattern, the electron density within the unit cell can be reconstructed.
The superposition of these sinusoidal waves, representing the diffraction peaks or Fourier components, recreates the original electron density distribution of the crystal.

To summarize, the diffraction peaks in the scattering pattern represent the Fourier components of the crystal's electron density distribution, and their spatial frequencies and phase relationships carry information about the crystal structure.
%The first sum is the unit cell structure factor, that modulates the scattered beam amplitude depending on what atoms are in the unit cell (amplitude) and their positions (phase).
%The second sum is the lattice factor that takes the value of $N_{uc}$ if $\vec{q}.\vec{R_k} = n \times 2\pi$ $(\ n \in \mathbb{Z})$.

The structure factor $F_{uc}$ is the summation of the contribution of each atom $j$ at the position $\vec{r}_j$ of atomic form factor $f_j(\vec{q})$ in the unit cell for a given scattering vector $\vec{q}$.
The position of each atom is defined in the unit cell by eq. \ref{eq:AtomPos}, an example with the platinum atoms in its primitive unit cell is given in tab. \ref{tab:PtAtoms}.

\begin{equation}
    \label{eq:AtomPos}
    \vec{r}_j = x_j\vec{a} + y_j\vec{b} + z_j\vec{c}
\end{equation}

\begin{table}[!htb]
    \centering
    \begin{tabular}{@{}lllllllllllllll@{}}
    \toprule
    Atom & Pt & Pt  & Pt  & Pt  & | Pt & Pt & Pt & Pt  & Pt  & Pt & Pt & Pt & Pt & Pt  \\ \midrule
    x    & 0  & 0.5 & 0.5 & 0   & | 1  & 0  & 1  & 0.5 & 1   & 0  & 1  & 0  & 1  & 0.5 \\
    y    & 0  & 0.5 & 0   & 0.5 & | 0  & 1  & 1  & 1   & 0.5 & 0  & 0  & 1  & 1  & 0.5 \\
    z    & 0  & 0   & 0.5 & 0.5 & | 0  & 0  & 0  & 0.5 & 0.5 & 1  & 1  & 1  & 1  & 1   \\ \bottomrule
    \end{tabular}
    \caption{Position of platinum atoms in the face-centered cubic (FCC) unit cell. Illustrated in fig. \ref{fig:fcc}. The first four atomic positions  lead to the other positions by symmetry.}
    \label{tab:PtAtoms}
\end{table}

Systematic extinctions ($F_{uc} = 0$) occur when certain diffraction peaks are forbidden due to the crystal's symmetry elements, such as the atomic positions.
For example in the FCC lattice of platinum, systematic extinctions occur when the value of Miller indices are not all even or all odds.
Otherwise, the intensity of a Bragg peak detected at the scattering vector $\vec{q}$ is equal to $4\times f_{Pt}(\vec{q})$ where $f_{Pt}(\vec{q})$ is the atomic scattering factor of platinum.

\subsection{Lattice factor} \label{sec:LatticeFactor}

If the scattering factor considers the composition of the unit cell, the lattice factor represents the contribution of the crystal lattice to the overall scattering amplitude.
It takes into account the arrangement of atoms or scatterers within the crystal lattice and their interaction with the incident wave.

By identifying the different parts of eq. \ref{eq:Fcrystal} and eq. \ref{eq:FcrystalFlatFuc} we can now isolate the lattice factor (eq \ref{eq:LatFactor}).
In the case of a simple cubic arrangement of unit cells in three directions perpendicular to each other, we can divide the sum over all the unit cells $N_{uc}$ in the crystal into three sums, each in one of the directions of the crystal lattice ($\vec{a}, \, \vec{b}, \, \vec{c}$) so that $N_{uc} = N_{uc, x} \times N_{uc, y} \times N_{uc, z}$.

\begin{gather}
    \label{eq:LatFactor}
    F_{lat} = \sum_k^{N_{uc}} e^{i\vec{q}.\vec{R_k}} = \sum_{n_x}^{N_{uc, x}} e^{i n_x\vec{q}.\vec{a}} \times \sum_{n_y}^{N_{uc, y}} e^{i n_y\vec{q}.\vec{b}} \times \sum_{n_y}^{N_{uc, z}} e^{i n_y\vec{q}.\vec{c}}\\
    F_{lat} = \prod_{j=\{x,y,z\}} \Bigg( \sum_{n_j}^{N_{uc, j}} e^{i n_j\vec{q}.\vec{a}_j} \Bigg)\\
    F_{lat} = \prod_{j=\{x,y,z\}} S_{N_{uc, j}}(\vec{q}.\vec{a}_j)
\end{gather}

\begin{gather}
    \label{eq:SFunction1}
    S_{N_{uc, j}}(\vec{q}.\vec{a}_j) = \sum_{n_j}^{N_{uc, j}} e^{in\vec{q}.\vec{a}_j} = \sum_{n_j}^{N_{uc, j}} e^{(i\vec{q}.\vec{a}_j)^n_j} = \frac{1-e^{(i N_{uc, j} \vec{q}.\vec{a}_j)}}{1-e^{(i\vec{q}.\vec{a}_j)}},\\
    \label{eq:SFunction2}
    |S_{N_{uc, j}}(\vec{q}.\vec{a}_j)| = \frac{\sin(N_{uc, j} \vec{q}.\vec{a}_j/2)}{\sin(\vec{q}.\vec{a}_j/2)},\\
    \label{eq:SFunction3}
    |S_{N_{uc, j}}(\vec{q}.\vec{a}_j)| \underset{N_{uc, j} \to \infty}{\longrightarrow} \approx \delta (\vec{q})
\end{gather}

Where $S_{N_{uc, j}}(\vec{q}.\vec{a})$ is a function whose modulus $|S_{N_{uc, j}}(\vec{q}.\vec{a})|$ tends towards a dirac function when $N_{uc, j} \longrightarrow \infty$.
The condition to observe peaks in eq. \ref{eq:SFunction2} is for the denominator to be equal to zero: $\frac{\vec{q}.\vec{a}_j}{2} \equiv \pi$ which brings us back to the Laue condition: $\vec{q} = \vec{G}$ where $\vec{G}$ is a reciprocal space lattice vector.
Minor peaks appear when the numerator is equal to one: $N\frac{\vec{q}.\vec{a}_j}{2} \equiv \frac{\pi}{2}$, the distance between each minor peak is equal to $\frac{2\pi}{t_j}$ where $t_j$ is the thickness of the crystal in the direction $\vec{a_j}$.

To resume, the lattice factor $F_{lat}(\vec{q})$ defines the shape of Bragg peaks.
For a large crystal (\textit{i.e.} a large number of unit cells in three directions), ideal Bragg peaks will look like Dirac functions (in reality they are widened due to different experimental factors).
For a small crystal such as nanoparticles, the fringes of the lattice factor will be further apart and their intensity more visible in contrast to the intensity of the main peak (fig. ).
In a more general sense, the lattice factor is the Fourier transform of the crystal's lattice, the effect of the Fourier transform is that fringes will be visible in the reciprocal space in directions perpendicular to the crystal's surface (fig. ).
The ability to effectively sample these fringes during experiments is at the root of the BCDI technique, to be able to perform the inverse Fourier transform of the Bragg peak to then retrieve the crystal shape (sec. \ref{sec:BCDI}).


\subsection{Coherence} \label{sec:Coherence}

Every x-ray source can be described by several parameters.
The brilliance $\mathcal{B}$ is a measure of the distribution of flux in both space and angular range, it indicates how the flux is spread over the source area and solid angle.

\begin{equation}
    \mathcal{B} = \frac{photons/second}{(mm^2 source \; area)(mrad)^2(0.1\% \; bandwidth)}
\end{equation}

The spectral flux, on the other hand, quantifies the number of photons passing through a defined area per unit bandwidth per second.
Synchrotron facilities aim to optimize both the photon flux and brilliance, a higher flux meaning faster experiments whereas a high brilliance is important for those that need a coherent beam.
To do so, the source size which is the convolution of the size of the photon source and the transverse size of the electron beam has been reduced by an order of magnitude in 4th generation synchrotrons compared to 3rd generation synchrotrons \parencite{Willmott}.

\begin{equation}
    \label{eq:Emittance}
    \epsilon = D \times \Delta\theta
\end{equation}
The emittance $\epsilon$ is defined as the product of the source size $D$ and the beam divergence $\Delta\theta$ (eq. \ref{eq:Emittance}), a low emittance is characteristic of a small source size and almost parallel emitted beams.

\begin{figure}[!htb]
    \centering
    \includegraphics[scale=0.9]{Figures/introduction/coherence_lengths.pdf}
    \caption{
    (a) Two waves become out of phase in the direction of the beam at a distance $L_L$ from being in phase after $N/2$ wavelengths for $\lambda$ and $(N+1)/2$ wavelengths for $\lambda - \Delta\lambda$. Since $N >> 1$, we can write $N\approx\lambda/\Delta\lambda$ and find eq. \ref{eq:LongitudinalCoL}.
    (b) A plane wave emitted from one extremity of the source is out of phase with another plane wave emitted from the other extremity with maximum angular divergence $\Delta\theta$ at a distance $L_T$ in the plane perpendicular to the direction of the beam situated at a distance $R$ from the source.
    }
    \label{fig:CoherenceLengths}
\end{figure}

The longitudinal coherence length $L_L$ describes the distance in the direction of the beam after which two waves of slighly different wavelength become out of phase due to the small extent of the beam bandwidth $\Delta\lambda$ (fig. \ref{fig:CoherenceLengths} - a).
The bandwidth is linked to the quality of the monochromator used to obtain a monochromatic beam through the relation $\lambda/\Delta\lambda$ (eq. \ref{eq:LongitudinalCoL}).

\begin{equation}
    \label{eq:LongitudinalCoL}
    L_L = \frac{\lambda^2}{2\Delta\lambda}
\end{equation}

The transverse coherence length $L_T$ describes the distance in the plane perpendicular to the beam after which two waves become out of phase due to the finite source size $D$ and to the angular divergence of the beam $\Delta\theta$ (fig. \ref{fig:CoherenceLengths} - b).
By assuming that the source has a Gaussian profile, we can relate $D$ to the standard deviation of the beam $\sigma_{H, V}$ in the horizontal and vertical directions perpendicular to the beam (\cite{Willmott}, eq. \ref{eq:TransverseCoL}).

\begin{equation}
    \label{eq:TransverseCoL}
    L_{T,(H, V)} = \frac{\lambda}{2\Delta\theta_{(H, V)}} = \frac{\lambda R}{2 D_{(H, V)}} = \frac{\lambda R}{2\sqrt{\pi}\sigma_{H, V}}
\end{equation}

At synchrotrons, the vertical and horizontal source size are significantly different due to the shape of the electron beam, much more extended in the horizontal plane.
The horizontal transverse coherence length is usually smaller and the limiting factor.
By multiplying the two transverse coherence lengths $L_{T,H}$, $L_{T,V}$ and the longitudinal coherence length $L_L$ we obtain the coherent volume.
An example if given in sec. \ref{sec:SIXS} for the SixS beamline of the synchrotron SOLEIL.

To perform Bragg coherent diffraction imaging experiments for which the coherent volume must be larger than the sample, the beamline must have low vertical and horizontal emittances, high monochromaticity and a sample environment situated as far as possible from the source.
Moreover, the coherent flux $F_{coh}$ as a function of the wavelength is directly related to the brilliance and bandwidth of the source \parencite{Willmott}:

\begin{equation}
    \label{eq:CoherentFlux}
    F_{coh} = \mathcal{B} \lambda^2 \frac{\Delta \lambda}{\lambda}
\end{equation}

Indeed, to be able to resolve the interference fringes resulting from the lattice factor, a high brilliance is crucial since the intensity of the total scattered field, proportional to the scattering volume, is weak.
A detailed explanation of how to optimize BCDI experiments is given in sec. \ref{sec:BCDI}.

\textit{
So far we have limited ourselves to the kinematical approach of diffraction in the frame of this thesis which means that the scattering is considered weak enough so that multiple scattering can be ignored.
This allows us to assume that the sample is only a perturbation to the incident field and that the structure factor can be written as the Fourier transform of the electronic density (Born approxiamtion).
We have also assumed that the incident wave is plane within the scattering volume and that the distance between the scatterer and the detector is large enough for the scattered waves to be considered planes.
}

\textcolor{Important}{
Field / amplitude / intensity consistent ?
$r_0$ use consistent ? $2\pi$ ?
hypothesis to explain: DWBA, dipole, perfect crystals
}
