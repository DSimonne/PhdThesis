\section{X-ray interaction with matter}

Understanding the different mechanisms at play when photons interact with matter is of crucial importance to be able to decide how to use X-rays as a probe in material science.
Each phenomenon (absorption, scattering, \textit{etc})}  is at the source of different techniques, diffraction brings surface X-ray diffraction (SXRD) and Bragg coherent diffraction imaging (BCDI), two techniques used in the frame of this thesis that give complementary information about the sample structure bulk and surface.

X-ray absorption together with the photoelectric effect explained by Einstein in 1905 are at the source of a third technique used, X-ray photoelectron spectroscopy, which yields information specific to the nature of the adsorbates on the sample's surface.

\begin{table}[!htb]
    \centering
    \small
    \begin{tabular}{l|l|l|l}
        Technique & Sample & Sensitivity & Information \\
        \toprule
        \textcolor{Important}{Bragg Coherent} & Pt nanoparticles & Bragg electronic & Shape, 3D strain  \\
        \textcolor{Important}{Diffraction Imaging} & (111), (110), (100), ... & density and phase & and displacement \\
        \textcolor{Important}{(BCDI)} &  &  & \\
        \midrule
        \textcolor{Important}{Surface X-ray} & Pt single crystals & Surface & Roughness, relaxation \\
        \textcolor{Important}{Diffraction (SXRD)} & (111), (100), (311) & structure & and crystallographic phases \\
        \midrule
        \textcolor{Blue}{X-ray Photoelectron} & Pt single crystals & Surface & Species presence, \\
        \textcolor{Blue}{Spectroscopy (XPS)} & (111), (100) & species & quantity, oxidation state \\
        \bottomrule
    \end{tabular}
    \caption{Near-ambient pressure (NAP) X-ray techniques carried out at the \textcolor{Important}{SixS} (SOLEIL) \\ or \textcolor{Blue}{B-07} (Diamond) beamlines}
    \label{tab:techniques}
\end{table}

\begin{figure}[!htb]
    \centering
    \includegraphics[height=0.25\textwidth]{/home/david/Documents/PhD/Presentations/Slides/PhdSlides/Figures/gwaihir/dp_pr.png}
    \includegraphics[height=0.25\textwidth]{/home/david/Documents/PhD/Presentations/Slides/PhdSlides/Figures/sxrd_data/Pt100/maps/Map_hkl_surf_or_2227-2283_not_patched.png}
    \includegraphics[height=0.25\textwidth]{/home/david/Documents/PhD/Presentations/Slides/PhdSlides/Figures/xps_data/transition_xps.png}
    \caption{Slice of 3D diffraction pattern collected at the SixS beamline at the SOLEIL synchrotron (left). Reciprocal space map in HK plane collected at the SixS beamline at the SOLEIL synchrotron (middle). Ambient pressure XPS spectra collected during a transition between two atmospheres (Ar and O$_2$), collected at the B07 beamline at the Diamond synchrotron (right).}
\end{figure}


In this chapter we will discuss the origin of each technique from fundamentals that not only tailor their experimental design but also their operability and sensitivity.

\subsection{Scattering from electrons and atoms}

The duality between wave and particles was first mentionned by Max Planck and Albert Einstein in the early 20${^th}$ century and generalized to all matter by Louis-Victor de Broglie in 1924 with the famous formula:

\begin{equation}
	\lambda = \frac{h}{p}
\end{equation}

Electromagnetic waves, \textit{i.e.} light or photons can be characterized by their energy $E$ in \si{\electronvolt} and wavelength $\lambda$ in \si{\meter}. $p$ corresponds to the momentum transfer.
The conversion between is realized thanks to Planck's constant $h = 6.626 \times 10^{-34}$ \si{\joule.\second} and the speed of light in vacuum $c = 2.9979 \times 10^{8}$ \si{\meter.\per \second} (eq. \ref{eq:EnergyLambda}).

\begin{equation}
    \label{eq:EnergyLambda}
	E = \frac{hc}{\lambda}
\end{equation}

The properties of the photon and its use in our society depends on its energy and wavelength.
If visible light is situated between $500 \si{\electronvolt}$ and $900 \si{\electronvolt}$, micro-waves used in our everyday life are situated between $10^{-6} \si{\electronvolt}$ and $10^{-4}\si{\electronvolt}$.
On the other side of the electromagnetic spectrum, we have higher energy photons such as X-rays ($\in [10^{2}, 10^{6}] \si{\electronvolt}$) and $\gamma$-rays (above $10^{6}$ $\si{\electronvolt}$).

X-rays have a wavelength of a few \si{\angstrom} ($10^{-10} \:\si{\meter}$) making them the perfect probe to study the structures of materials at the atomic scale thanks to different interactions with matter.

\subsubsection{Cross-sections}

When an electromagnectic beam interacts with matter it will be attenuated by absorption, reflection or scattering.
Each process can be quantified depending on the atoms (and thus on the electronic cloud) the beam interacts with and the energy on the incident photon, this is illustrated in figure \ref{fig:cross_sections}.
The cross-section for a particuliar process $p$ is defined as follows \parencite{Willmott}:

\begin{equation}
	\sigma_p = (\Lambda_p N_i)^{-1}
\end{equation}

$\Lambda_p$ is the attenuation length in \si{\meter}, \textit{i.e.} the length after which the beam is reduced to $1/e$, $N_i$ is the atomic number-density in atoms/unit volume.

\begin{figure}[!htb]
    \centering
    \includegraphics[width=\textwidth]{Figures/introduction/cross_sections.pdf}
    \caption{Cross-sections for Platinum (Z=78) for various processes that occur when photons interact with matter. The data was taken from the NIST (National Institute of Standards and Technology) \parencite{NIST_cross_sections} website. The energy range of the SixS beamline at SOLEIL is highlighted in blue.}
    \label{fig:cross_sections}
\end{figure}

Compton scattering, also named inelastic scattering, is a process during which some of the incident electromagnetic wave energy is transfered to the atoms' electrons.
This results in a lower energy for the scattered photon (and therefore a higher wavelength) compared to the incident photon.
%This effect has a low cross-section compared to the two other processes and is therefore not taken account during the experiments.

In the frame of this thesis, the (elastic) Thomson scattering cross-sections is the most important, at the origin of X-ray diffraction.
This process is dominant for energies below $200 \si{k\electronvolt}$, together with photoelectric absorption.% for which the K, L and M edges are shown.

\subsubsection{Scattering from an electron}

We begin our discussion of X-ray scattering by considering scattering from a single free electron using classical electromagnetic theory.
During elastic scattering, the oscillating electric field of the incident X-ray wave exerts an electromagnetic force on the electron, causing it to accelerate and oscillate in the same direction as the incident electronic field.

\begin{figure}[!htb]
    \centering
    \includegraphics[width=\textwidth]{Figures/introduction/torus.pdf}
    \caption{
        Effect of relation between synchrotron X-ray polarization $\hat{\epsilon}$ and scattered X-ray polarization $\hat{\epsilon}'$ on the scattered field.
        Working in the vertical plane is preferable to maximize the intensity of the scattered field, this has pratical repercussions in surface X-ray diffraction for which it is preferable to work in a vertical geometry to scan large 2D areas of the reciprocal space (a).
        The scattered field intensity is attenuated by a $\cos{\theta}$ factor, where $\theta$ is the angle between the plane perpendicular to the electric field and the direction of observation $\vec{r}$ (b)
    }
    \label{fig:polarization_effect}
\end{figure}

During an elastic scattering event, the oscillating electron emits a spherical electromagnetic wave with the same wavelength as the incident beam (Thomson scattering).
The scattered field $\vec{E}_{scatt}$ is then proportional to the incident electromagnetic field $\vec{E}_{in}$ as follows \parencite{NielsenMcMorrow}:

\begin{equation}
    \label{eq:scatt_field}
    \frac{\vec{E}_{scatt}(R, \, t)} {\vec{E}_{in}} = -r_0 \frac{e^{\vec{k}.\vec{R}}} {|\vec{R}|}| \hat{\epsilon}.\hat{\epsilon}'|
\end{equation}
$|\vec{R}|$ is the distance at which the scattering is detected at the time $t$, $\hat{\epsilon}$ is the synchrotron X-ray polarization vector, $\hat{\epsilon}'$ the scattered X-ray polarization vector, and $r_0$ is the Thomson scattering length or the classical radius of the electron defined as:

\begin{equation}
    \label{eq:scatt_thomson_scat_length}
    r_0 = \frac{e^2} {4\pi\epsilon_0 m_e c^2}
\end{equation}
with $m_e$ the mass of the electron and $\epsilon_0$ the permittivity of free space.

The minus sign illustrates a phase shift of $\pi$ between the incident and scattered wave, $\hat{\epsilon}$ and $\hat{\epsilon}'$ are respectively the polarization vectors of the incident and scattered electromagnectic fields.

The differential cross-section for Thomson scattering measures the efficiency of the scattering in the volume occupied by a solid angle $d\Omega$ in the direction $\vec{R}$ \parencite{NielsenMcMorrow}. It is defined as follows:
\begin{equation}
    \label{eq:dif_cross_sec_thomson1}
    \frac{d\sigma_{ts}} {d \Omega} = \frac{ |\vec{E}_{scatt}(R, t)|^2 R^2} {|\vec{E}_{in}|^2}
\end{equation}

By substituting eq. \ref{eq:scatt_field} into eq. \ref{eq:dif_cross_sec_thomson1}, it becomes clear that the scattering is proportional to the Thomson scattering length and that the intenisty is attenuated depending on the dot product between the two polarizations.
The polarization factor $P$ for scattered beams is defined as $P =  | \hat{\epsilon}.\hat{\epsilon}'|^2$ and we can write the differential cross-section as:

\begin{equation}
    \frac{d\sigma_{ts}} {d \Omega} = r_0^2 | \hat{\epsilon}.\hat{\epsilon}'|^2 = r_0^2 P
\end{equation}

The effect of the polarization of the incident beam is illustrated in figure \ref{fig:polarization_effect}.
At synchrotron sources where the incident beam is horizontally polarized, working in the vertical plane becomes more effective since the polarization factor is always equal to one.

The total cross-section for the scattering event by a single free electron can be computed by integrating the differential cross-section over all the possible scattering angles, \textit{i.e.} by averaging all possible polarization directions \parencite{Willmott}.
This yields $\sigma_{ts} = 8 \pi r_0^2 /3 = 0.665 \:\si{\barn}$, the total Thomson scattering cross-section is constant, independent of the incoming photon energy. This results holds for X-rays for which the scatterer \textit{i.e.} the electron can be considered as free \parencite{Willmott}.

\subsubsection{Scattering from a single atom}

As we have seen the main scatterer for Thomson scattering is the electron.
Each atom can be described as a small volume $d^3\vec{r}$ in the electronic density, and the scattered field by the superposition of the contribution from the electronic cloud surrounding the atoms.

The scattering of the incident beam from an atom is therefore proportional to the electronic density $\rho_{atom}(\vec{r})$.
For a single atom of atomic number $Z$ we have :

\begin{equation}
    \int \rho_{atom} (\vec{r}) d^3\vec{r} = Z
\end{equation}

The scattering amplitude depends on the wavelength of the incident beam $\lambda$, and on the direction of detection defined by the scattering angle $2\theta$ between the wavevector of the incident photon $\vec{k_i}$ and the wavevector of the scattered photon $\vec{k_s}$ (fig. \ref{fig:q}).

\begin{figure}[!htb]
    \centering
    \includegraphics[scale=0.6]{Figures/introduction/q.pdf}
    \caption{Geometry of the scattering vector $\vec{q}$ in reciprocal space, $2\theta$ is the scattering angle. The magnitude of the scattering vector can be derived with the angle $\theta$ that draws a line cutting $\vec{q}$ at $|\vec{q}|/2$.}
    \label{fig:q}
\end{figure}

This leads to the definition of the scattering vector, $\vec{q}$, to describe the amplitude of a scattering event (eq. \ref{eq:Q}, fig. \ref{fig:q}).

\begin{equation}
    \label{eq:Q}
    \vec{q}=\vec{k_s}-\vec{k_i}.
\end{equation}

\begin{equation}
    \label{eq:QSinTheta}
    |\vec{q}| = \frac{4\pi}{\lambda} \sin{\theta}
\end{equation}

The phase difference between a wave scattered at a position $O
$ and a wave scattered at a distance $\vec{r}$ from $O$ is equal to $(\vec{k_i} - \vec{k_s}).\vec{r} = \vec{q}.\vec{r}$ (fig. \ref{fig:q}).
We assume here that the scattering event is elastic ($|\vec{k_i}|=|\vec{k_s}|$) and that the waves are plane waves parallel to each other when in the small scattering volume $d^3\vec{r}$.

A small volume $d^3\vec{r}$ will have a contribution equal to $-r_0 \rho(\vec{r})d^3\vec{r}$ to the scattered field with a phase $e^{i\vec{q}.\vec{r}}$.
%Thus, the total scattering amplitude at $2\theta$ will be equal to the vector sum of the scattering amplitudes in this direction from all volume elements $d^3\vec{r}$ in $\rho(\vec{r})$ taking into account the phases between them.

By integrating over the volume occupied by the atom we obtain the total contribution of an atom to the scattered field in the direction $2\theta$:

\begin{equation}
    \label{eq:AtomicFormFactor}
    -r_0 \int \rho (\vec{r}) e^{i\vec{q}.\vec{r}} d\vec{r} = -r_0 f(\vec{q}) = -r_0 FT [\rho (\vec{r})]
\end{equation}

The scattering amplitude as a function of $\vec{q}$ is described by the atomic scattering factor $f(\vec{q})$, which is defined as the Fourier transform of the electronic density $\rho(\vec{r})$.
This hypothesis is at the basis of several techniques such as Bragg coherent diffraction imaging for which we use Fourier transforms to compute the scattered amplitude (sec. X).

The values for the atomic scattering factor can be approximated by a sum of Gaussians using tabulated coefficients (eq. \ref{eq:AtomicFormFactorTab}) available online \parencite{InterTablesOfCryst}.
It decreases with $\vec{q}$ (or $\sin(\theta) / \lambda)$ as illustrated in figure \ref{fig:atomic_form_factor}.

\begin{equation}
    \label{eq:AtomicFormFactorTab}
    f(\vec{q}) = \sum_{i=1}^4 a_i \exp (-b_i (\frac{q} {4\pi})^2) + c
\end{equation}

The scattering intensity is equal to the square of the scattering amplitude.
For example, the scattering intensity of palladium atoms at $|\vec{q}| \approx 2.75 \AA^{-1}$ is only $\approx 31\%$ of that of platinum atoms. In the case of oxygen, the intensity falls down to $\approx 6.7\%$.
This difference in scattering intensity between elements becomes crucial when working with small objects that have a small scattering volume such as nanoparticles, as in Bragg Coherent Diffraction Imaging.

\begin{figure}[!htb]
    \centering
    \includegraphics[width=\textwidth]{Figures/introduction/atomic_form_factor.pdf}
    \caption{
    Atomic form factor calculated for Pt (Z=78) using tabulated values \parencite{InterTablesOfCryst} for equation \ref{eq:AtomicFormFactor}. The scattering intensity decreases with the scattering angle $\theta$ but increases with the incident wavelength $\lambda$. $i$ and $c$ respectively designate the Gaussian contribution and constant in eq. \ref{eq:AtomicFormFactorTab}.
    }
    \label{fig:atomic_form_factor}
\end{figure}

\subsection{Scattering from crystals}

A crystal is a solid material composed of a regular, repeating arrangement of atoms, ions, or molecules (\textit{i.e.} a pattern), exhibiting a highly ordered structure with long-range periodicity in three dimensions.

A Bravais lattice refers to an infinite array of points (nodes) that represents the basic repeating unit of a crystal lattice, defining the translational symmetry of the crystal structure.
It is characterized by a set of three basis vectors and their linear combinations, which generate the entire lattice when translated in space.
The \textit{primitive} unit cell is the smallest cell with which you can describe the crystal.

The structure of the Bravais lattice (cubic, hexagonal, ...) combined with the position of the patterns in the lattice and the symmetry relations between them defines the crystal \textit{space group}.
In total there exist 230 space group in crystallography.
In the simplest case the pattern consists of a single atom, for example pure Platinum (Z=78) cristallizes at room temperature in a cubic Bravais lattice (fig. \ref{fig:fcc}).

We can define the scattering factor $F_{crystal}$ of the crystal by the sum of the atomic scattering factor of each atom present in the crystal: 

\begin{equation}
    F_{crystal}(\vec{q}) = \sum_j^{N_{atom}} f_j(\vec{q}) e^{i\vec{q}.\vec{r}_j}
\end{equation}

$f_j(\vec{q})$ is the atomic scattering factor of the $j^{th}$ atom at position $\vec{r}_j$ in a crystal made of $N_{atom}$ atoms.
The Thomson scattering length is left apart for simplicity.

\begin{figure}[!htb]
    \centering
    \includegraphics[width=\textwidth]{/home/david/Documents/PhDScripts/drawing/blender/FCC.png}
    \caption{Face centered cubic (FCC) lattice of Pt (space group 225). Atoms are represented as solid balls and situated on the corners and at the middle of the faces. The lattice parameter at room temperature is $a = 3.9254 \:\AA$. Close packed direction is achieved along the diagonal of the lateral faces, the distance between the atoms then becomes is $2.71 \:\si{\angstrom}.$}
    \label{fig:fcc}
\end{figure}

The position of any atom in the crystal $\vec{r}_j$ is equal to the sum of the position of the unit cell $\vec{R}_{uc}$ plus the position of the atom within the unit cell $\vec{r}_j$.
For a crystals made of $N_{uc}$ unit cells each composed of $N_{atoms}$ we have:

\begin{equation}
    F_{crystal} = \sum_j^{N_{atoms}} f_j(\vec{q}) e^{i\vec{q}.\vec{r}_j} \sum_k^{N_{uc}} e^{i\vec{q}.\vec{R_k}}
    \label{eq:Fcrystal}
\end{equation}

% As seen in Equation (\ref{eq:scatt_thomson_scat_length}), the Thomson scattering length is inversely proportional to the mass of the particle, while the scattering cross-section is proportional to the square of the Thomson scattering length.
% Hence the nucleus contributes less than one part in a million to the scattering amplitude and can be completely ignored.
% The charge distribution is therefore equal to the electronic density.

% When detecting the scattered field at a point $\vec{R}$, we assume that $\|vec{R}|$ is far greater than the electronic density, this is called the dipole approximation. NOT GOOD Each atom can be considered as a ball of certain radius (see \ref{fcc_lattice}).

% Furthermore, we assume that the source and detector are sufficiently far from the charge distribution so that the incident and scattered X-rays may be represented as plane waves, parallel to each other and perpendicular to the direction of propagation. % also more easily described
%This is the so-called far-field limit or the fraunhofer region.

% Finally, we assume that the charge distribution is small and that the scattering is weak so that the sample can be treated as a simple "perturbation" to the incident beam resulting in a linear problem \parencite{NielsenMcMorrow} and that the Born approximation is valid.

% Working under these assumption is known as kinematic diffraction for which we can easily derive the intensity of the scattered photons.
% We therefore ignore multiple-scattering of photons inside the sample and xxx.
% This is correct when working with low incident angles and penetration depths as for example in surface X-ray diffraction (see Section x).

% only valid in far-field, faunhofer region
% DWBA
% dipole approximation

The Bravais lattice is defined by three basis vectors $\vec{a},\ \vec{b},\ \vec{c}$ and three angles $\alpha$ [$\angle (\vec{b}, \vec{c})$] , $\beta$ [$\angle (\vec{a}, \vec{c})$] and $\gamma$ [$\angle (\vec{a}, \vec{b})$].
Any vector $\vec{R_k}$ describing the position of a node in the real space can be created by a linear combination of these three vectors:

\begin{equation}
    \label{eq:R_k}
    \vec{R_k}=n_1\vec{a} + n_2\vec{b} + n_3\vec{c}, \quad \ (n_1,n_2,n_3) \in \mathbb{Z}^3
\end{equation}

To understand the contribution of the second sum in eq. \ref{eq:Fcrystal}, it is convenient to introduce the \textit{reciprocal space} which is the Fourier transform of the real space.
It is defined by three basis vectors $\vec{a*},\ \vec{b*},\ \vec{c*}$.
Similarly, the nodes of the reciprocal space can be accessed from its origin by a linear combination $\vec{G}$ of these three vectors.

\begin{equation}
    \vec{a^*}=\frac{2\pi}{V}(\vec{b}\times \vec{c}), \qquad
    \vec{b^*}=\frac{2\pi}{V}(\vec{c}\times \vec{a}), \qquad
    \vec{c^*}=\frac{2\pi}{V}(\vec{a}\times \vec{b}), \qquad
    \vec{a}_i . \vec{a}_j^* = \delta_{i,j}
\end{equation}

\begin{equation}
    \label{eq:G}
    \vec{G}=h\vec{a}^* + k\vec{b}^* + l\vec{c}^*, \quad \ (h,k,l) \in \mathbb{Z}^3
\end{equation}

By combining eq. \ref{eq:R_k} and eq. \ref{eq:G} we find that the solution to the second sum in eq. \ref{eq:Fcrystal}, \textit{i.e.} to the equation $\vec{q}.\vec{R_k} = n \times 2\pi$ $(\ n \in \mathbb{Z})$ is to write $\vec{q}$ as a linear combination of the reciprocal space vectors, textit{i.e.} as $\vec{G}$.

\begin{equation}
    \label{eq:LaueCond}
    \vec{G} . \vec{R_k} = hn_1 + kn_2 + ln_3 = n \quad  with \ n \in \mathbb{Z}
\end{equation}

This is also known as the Laue condition, that ensures that only certain scattering vectors, corresponding to the reciprocal lattice points, fulfill the condition for constructive interference between the scattered waves.
These specific scattering vectors determine scattering direction and angle of the peaks observed in a diffraction pattern, also known as Bragg peaks.

\begin{equation}
    \vec{q} = \vec{G}  = h\vec{a}^* + k\vec{b}^* + l\vec{c}^*
\end{equation}

\subsection{Bragg's Law}

The intensity scattered from a crystal as a function of the scattering vector $\vec{q}$ provides information about the arrangement and spacing of crystalline planes perpendicular to $\vec{q}$.
The Miller indices are a set of integers used to represent the planes' orientation and spacing.
A plane denoted by the ($h, k, l$) indices intercepts the axes $\vec{a}$, $\vec{b}$, $\vec{c}$ on the points $|\vec{a}|/h, |\vec{b}|/k, |\vec{c}|/l$.
The direction perpendicular to the $(hkl)$ plane is written as $[hkl]$, the distance between each plane is $d_{hkl}$.

\begin{figure}[!htb]
    \centering
    \includegraphics[scale=0.6]{Figures/introduction/BraggLaw.pdf}
    \caption{The difference in the path length between plane waves scattered at an angle $\theta$ must be an integer multiple of wavelengths for constructive interference to occur. NOT FINISHED}
    \label{fig:BraggLaw}
\end{figure}

A Bragg peak results from the constructive interference between coherently scattered waves at discrete values of the incident angle $2\theta$ on a specific set of crystalline planes.
From fig. \ref{fig:BraggLaw} we can retrieve the condition to have constructive interference, also known as Bragg law and given by eq. \eqref{eq:Bragglaw}.

\begin{equation}
    \label{eq:Bragglaw}
    n\lambda = 2d_{hkl} \sin{\theta}, \quad \ n \in \mathbb{Z}
\end{equation}

% \begin{gather}
%     \frac{(2\pi)^2}{d_{hkl}^2} = h^2 \, (\Vec{a^*}.\Vec{a^*}) + k^2 \,
%     \label{eq:dsquare}(\Vec{b^*}.\Vec{b^*}) + l^2 \, (\Vec{c^*}.\Vec{c^*}) + 2hk \, (\Vec{a^*}.\Vec{b^*}) + 2hl \, (\Vec{a^*}.\Vec{c^*}) + 2kl \, (\Vec{b^*}.\Vec{c^*})\\
%      \frac{(2\pi)^2}{d_{hkl}^2} = h^2 \, {a^*}^2 + k^2 \, {b^*}^2 + l^2 \, {c^*}^2 + 2hk \, {a^*}.{b^*}\cos{\gamma^*} + 2hl \, {a^*}.{c^*}\cos{\beta^*} + 2kl \, {b^*}.{c^*}\cos{\alpha^*}\\
%      \frac{(2\pi)^2}{d_{hkl}^2} = Ah^2 + Bk^2 + Cl^2 + Dhk + Ehl + Fkl
%      \label{eq:RecSpaceMetricTensor}
% \end{gather}{}

In the case of a cubic Bravais lattice, the distance between Miller planes can be written as:
\begin{equation}
    \label{eq:Interplanarspacing}
    d_{hkl}=\frac{2\pi}{|\vec{a^*}|\sqrt{h^2 + k^2 + l^2}}=\frac{|\vec{a}|}{\sqrt{h^2 + k^2 + l^2}}
\end{equation}

From eqs. \ref{eq:QSinTheta} and \ref{eq:Bragglaw}, we fall back on the Laue condition which is a generalization of Bragg law. The diffraction order ($n$) in the Bragg's law equation can be omitted since it is implicitly determined by the Miller indices (hkl) representing the crystalline planes involved in the diffraction.

\begin{gather}
    \label{eq:QandD}
    |\vec{Q}| = \frac{4\pi \sin(\theta)}{\lambda},\\
    \sin(\theta) / \lambda = \frac{1}{2d_{hkl}},\\
    |\vec{Q}| = \frac{2\pi}{d_{hkl}}
\end{gather}{}

When fulfilling the Laue (or Bragg) condition, the direction of the scattering vector is perpendicular to the crystalline planes represented by the ($h, k, l$) Miller indices, and its magnitude is inversely proportional to the distance between consecutive crystalline planes.

\subsection{Structure factor}

On one hand, in real space, the crystal electronic density can be formed by repeating the unit cell at each lattice point, \textit{i.e.} it can be represented as a convolution of the lattice and unit cell functions.
%The electronic density $\vec{r}$ is formed by repeating the lattice function at each lattice point and adding the basis function associated with that lattice point.
This representation captures the periodicity and arrangement of the crystal.

On the other hand, in reciprocal space (Fourier space), the crystal scattering factor $F_{crystal}$ is the Fourier transform of the electronic density.
According to the convolution theorem, the Fourier transform of a convolution is equal to the product of the Fourier transforms of the individual functions.
The scattering factor can therefore be expressed as the product of the Fourier transforms of the lattice and unit cell functions.
These Fourier transforms are known as the lattice factor $F_{lat}$ and the unit cell structure factor $F_{uc}$.

\begin{equation}
    F_{crystal} = FT[\rho(\vec{r})] = F_{uc} \times F_{lat}
    \label{eq:FcrystalFlatFuc}
\end{equation}

The lattice factor $F_{lat}$ represents the periodic arrangement of the crystal lattice in Fourier space, corresponding to the reciprocal lattice.
It determines the positions and intensities of the diffraction peaks in the scattering pattern.
The unit cell structure factor $F_{uc}$ describes the distribution of electron density within the unit cell of the crystal and modulates the scattered beam amplitude depending on what atoms are in the unit cell (amplitude) and their positions (phase).

Each diffraction peak in the scattering pattern corresponds to a specific Fourier component, representing a sinusoidal wave of electron density with a particular frequency and direction determined by its scattering vector $\vec{q}$, \textit{i.e.} by its position in Fourier space.
By knowing the phase relationships between these Fourier components, which can be obtained from the measured diffraction pattern, the electron density within the unit cell can be reconstructed.
The superposition of these sinusoidal waves, representing the diffraction peaks or Fourier components, recreates the original electron density distribution of the crystal.

To summarize, the diffraction peaks in the scattering pattern represent the Fourier components of the crystal's electron density distribution, and their spatial frequencies and phase relationships carry information about the crystal structure.
%The first sum is the unit cell structure factor, that modulates the scattered beam amplitude depending on what atoms are in the unit cell (amplitude) and their positions (phase).
%The second sum is the lattice factor that takes the value of $N_{uc}$ if $\vec{q}.\vec{R_k} = n \times 2\pi$ $(\ n \in \mathbb{Z})$.

By identifying the different parts of eq. \ref{eq:Fcrystal} and eq. \ref{eq:FcrystalFlatFuc} we can first isolate the structure factor:

\begin{equation}
    \label{eq:StrucFactor}
    F_{uc} = \sum_j^{N_{atoms}} f_j(\vec{q}) e^{i\vec{q}.\vec{r}_j}
\end{equation}

The structure factor is the summation of the contribution of each atom $j$ at the position $\vec{r}_j$ of atomic form factor $f_j(\vec{q})$ in the unit cell for a given scattering vector $\vec{q}$.
The position of each atom is defined in the unit cell by eq. \ref{eq:AtomPos}, an example with the Platinum atoms in its primitive unit cell is given in tab. \ref{tab:PtAtoms}.

\begin{equation}
    \label{eq:AtomPos}
    \vec{r}_j = x_j\vec{a} + y_j\vec{b} + z_j\vec{c}
\end{equation}

\begin{table}[!htb]
    \centering
    \begin{tabular}{@{}lllllllllllllll@{}}
    \toprule
    Atom & Pt & Pt & Pt & Pt & Pt  & Pt  & Pt  & Pt  & Pt  & Pt & Pt & Pt & Pt & Pt  \\ \midrule
    x    & 0  & 1  & 0  & 1  & 0.5 & 0.5 & 0   & 0.5 & 1   & 0  & 1  & 0  & 1  & 0.5 \\
    y    & 0  & 0  & 1  & 1  & 0.5 & 0   & 0.5 & 1   & 0.5 & 0  & 0  & 1  & 1  & 0.5 \\
    z    & 0  & 0  & 0  & 0  & 0   & 0.5 & 0.5 & 0.5 & 0.5 & 1  & 1  & 1  & 1  & 1   \\ \bottomrule
    \end{tabular}
    \label{tab:PtAtoms}
    \caption{Position of Platinum atoms in the face-centered cubic (FCC) unit cell. Illustrated in fig. \ref{fig:fcc}}
\end{table}

Systematic extinctions ($F_{uc} = 0$) occur when certain diffraction peaks are forbidden due to the crystal's symmetry elements, such as the atomic positions.
For example in the FCC lattice of Platinum, systematic extinctions occur when the value of Miller indices are not all even or all odds.
Otherwise, the intensity of a Bragg peak detected at the scattering vector $\vec{q}$ is equal to $4\times f_{Pt}(\vec{q})$ where $f_{Pt}(\vec{q})$ is the atomic scattering factor of Platinum.

\subsection{Lattice factor}

If the scattering factor considers the composition of the unit cell, the lattice factor represents the contribution of the crystal lattice to the overall scattering amplitude.
It takes into account the arrangement of atoms or scatterers within the crystal lattice and their interaction with the incident wave.

By identifying the different parts of eq. \ref{eq:Fcrystal} and eq. \ref{eq:FcrystalFlatFuc} we can now isolate the lattice factor (eq \ref{eq:LatFactor}).
Instead of considering one sum over all the unit cells $N_{uc}$ in the crystal, we can work with the product of three sums, each in one of the three directions of the crystal lattice ($\vec{a}, \vec{b}, \vec{c}$) so that $N_{uc} = N_{uc, x} \times N_{uc, y} \times N_{uc, z}$.

\begin{gather}
    \label{eq:LatFactor}
    F_{lat} = \sum_k^{N_{uc}} e^{i\vec{q}.\vec{R_k}} = \sum_{m_x}^{N_{uc, x}} e^{i m_x\vec{q}.\vec{a}} \times \sum_{m_y}^{N_{uc, y}} e^{i m_y\vec{q}.\vec{b}} \times \sum_{m_y}^{N_{uc, z}} e^{i m_y\vec{q}.\vec{c}},\\
    \prod_{j=1}^3
\end{gather}

\subsection{Coherence}


\textit{
So far we have limited ourselves to the kinematical approach of diffraction in the frame of this thesis.
This means that multiple scattering and effect of absorption and refraction are ignored during diffraction.
This is justified for Surface X-ray diffraction by the fact that the incoming angle is very low ($\approx 0.3$) and for BCDI by the low volume of the sample ($\approx 0.1 \mu m^3$).
}

\textcolor{Important}{Field / amplitude / intensity consistent ? $r_0$ use consistent ? $2\pi$ ? Where to mention that here we are using several hypothesis (Born approximation, DWBA, dipole), real crystals, fourier tranform, convolution
Define well}
